<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<script type="text/javascript"
  src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f51f22a3699fa4000697e5b37ae2ffe4&libraries=services,clusterer,drawing"></script>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css}" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
		<link th:href="@{/css/main.css}" rel="stylesheet" />
		<link th:href="@{/css/star.css}" rel="stylesheet" />
		<link th:href="@{/css/map.css}" rel="stylesheet" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script
		  th:src="@{https://dapi.kakao.com/v2/maps/sdk.js(appkey=f51f22a3699fa4000697e5b37ae2ffe4)}"
		  defer></script>
		<script type="module" th:src="@{/js/views.js}" defer></script>
		<script type="module" th:src="@{/js/register.js}" defer></script>
		<script type="module" th:src="@{/js/Authentication.js}" defer></script>
		<script type="module" th:src="@{/js/profileImg.js}" defer></script>
		<script type="module" th:src="@{/js/myreviews.js}" defer></script>
		<script type="module" th:src="@{/js/memberUpdate.js}" defer></script>
		<script type="module" th:src="@{/js/bookMark.js}" defer></script>
		<script type="text/javascript" th:src="@{/js/admin.js}" defer></script>
		<title>문화 Hang의 길을 따라..</title>
	</head>
	<body>
	
		<div class="container">
		  <div class="row" id="navPosition">
		    <nav th:if="${session.member == null}" id="nav-default" th:insert="~{fragments/nav :: nav}" th:onclick="sessionStorageClear()"></nav>
		    <nav th:if="${session.member != null}" id="nav-login" th:insert="~{fragments/loginnav :: loginnav}"></nav>
		  </div>
		</div>
		
		<div style="z-index: 9999; position: relative;">
		  <div class="sidebar" style="box-shadow: 1px 1px 5px rgb(98, 107, 233);">
		    <div class="searchTop">
		    <button type="button" class="btn-close noSidebar" style="float:right; font-size: 1.2em; position: absolute;  top: 10px; right: 10px;" data-bs-dismiss="sidebar" aria-label="Close"></button>
		      <p style="font-size: 1.3em; letter-spacing:5px; font-family: 'moonhwa'; margin: 10px 0px;">검색결과</p>
		      <p id="searchCount" style="font-family: 'moonhwa'; font-size: 1em;"></p>
		    </div>
		    <div id="searchResult" class="scrollBarDesign">
		      <div style="text-align: center; border:none;">
		        <p style="font-size: 1.5em; color: rgb(171, 17, 126); font-weight: bold; text-align: center; margin-top: 50%;">대기중</p>
		        <img class="nugiimg" alt="" src="./img/nugi.png">
		      </div>
		    </div>
		  </div>
		</div>
		
		
		<div id="map"></div>
		<div id="modalDetail"></div>
		<div id="modalPoint"></div>
		<div id="modalPoint2"></div>
		<div id="modalPoint3"></div>
		<div id="modalBookmark"></div>
		<div id="modalWithdrawal"></div>
	
		<script type="text/javascript">
			var container = document.getElementById('map'); 
			var options = { 
				center : new kakao.maps.LatLng(37.578559, 126.977007),
				level : 5
			};
			var map = new kakao.maps.Map(container, options); 
		
			var mapTypeControl = new kakao.maps.MapTypeControl();
			map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
			var zoomControl = new kakao.maps.ZoomControl();
			map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
			var marker = new kakao.maps.Marker();
			var infowindow = new kakao.maps.InfoWindow({ disableAutoPan: true });
			
			let menuicon = document.querySelector('#menuicon');
			let sidebar = document.querySelector('.sidebar');
			let searchTop = document.querySelector('.searchTop');
			let noSidebarBtn = document.querySelector('.noSidebar');
		
			if (menuicon && sidebar) {
				  menuicon.addEventListener('click', () => {
				    if (menuicon.checked) {
				      sidebar.style.left = '0';
				      searchTop.style.left = '0';
				    } else {
				      sidebar.style.left = '-100%';
				      searchTop.style.left = '-100%';
				    }
				  });
			}
			if(sidebar){
		         noSidebarBtn.addEventListener('click', () => {
		   	        sidebar.style.left = '-100%';
		   	     	searchTop.style.left = '-100%';
		            menuicon.checked = false;
		         });
		    }
			var searchTopHeight = document.querySelector('.searchTop').offsetHeight;
			var searchCountHeight = document.querySelector('#searchCount').offsetHeight;
			var maxHeight = document.querySelector('.sidebar').offsetHeight - (searchTopHeight + searchCountHeight + 40);
			document.getElementById('searchResult').style.maxHeight = maxHeight + 'px';
			document.getElementById('searchResult').style.marginTop = (searchTopHeight + searchCountHeight + 40) + 'px';
		</script>
	    
	    <script type="text/javascript" defer>
	    /**
	     * 나의리뷰 게시판
	     */
	    var tableList = []; 
	    var pageList = 10;
	    var pageMax = 5;    
	    var idx = 0;
	    var page = 1; 
	
	    function myreviewsTableInsert(data) {
	    	tableList = [];
	    	for (var i = 0; i < data.length; i++) {
	    		var jsonObject = {
	    			"idx": i + 1,
	    			"writerCCBAASNO": data[i].ccbaAsno,
	    			"writerCCBAMNM1": data[i].ccbaMnm1,
	    			"writerStarpoint": data[i].starpoint,
	    			"writerComment": data[i].comment,
	    			"writerCommentDate": data[i].commentDate
	    		};
	    		tableList.push(jsonObject);
	    	}
	    	myreviewsPageInsert(page);
	    };
	
	    function myreviewsPageInsert(value) {
	    	$("#dyn_ul").empty();    
	    	var startIndex = value;
	    	var endIndex = tableList.length;
	    	var pageCount = 0;
	    	var pagePlus = 0;
	    	if (endIndex > pageList) {
	    		pageCount = Math.floor(endIndex / pageList);
	    		pagePlus = endIndex % pageList;
	    		if (pagePlus > 0) {
	    			pageCount = pageCount + 1;
	    		}
	    	}
	    	if (startIndex > pageCount) {
	    		startIndex = page;
	    	}
	    	else if (startIndex < 0) {
	    		startIndex = page;
	    	}
	    	else {
	    		page = startIndex;
	    	}
	    	if (pageCount == 1) {
	    		var insertUl = "<li class='page-item'>";
	    		insertUl += insertUl + "<a class='page-link' href='javascript:void(0)' onclick='myreviewsNewPage(1);'>";
	    		insertUl += insertUl + i;
	    		insertUl += insertUl + "</a></li>";
	    		$("#dyn_ul").append(insertUl);          
	    	}
	    	else if (pageCount >= 2) {
	    		var insertSTR = "<li class='page-item'>"; // 변수 선언
	    		insertSTR = insertSTR + "<a class='page-link' href='javascript:void(0)' onclick='myreviewsNewPage(" + "-1" + ");'>";
	    		insertSTR = insertSTR + "이전";
	    		insertSTR = insertSTR + "</a></li>";
	    		$("#dyn_ul").append(insertSTR);
	    		var count = 1;
	    		for (var i = startIndex; i <= pageCount; i++) {
	    			if (count > pageMax) {
	    				page = i - pageMax;
	    				break;
	    			}
	    			var insertUl = "<li class='page-item'>";
	    			insertUl = insertUl + "<a class='page-link' href='javascript:void(0)' onclick='myreviewsNewPage(" + i + ");'>";
	    			insertUl = insertUl + String(i);
	    			insertUl = insertUl + "</a></li>";
	    			$("#dyn_ul").append(insertUl);
	    			count++;
	    		}
	    		
	    		var insertEND = "<li class='page-item'>"; 
	    		insertEND = insertEND + "<a class='page-link' href='javascript:void(0)' onclick='myreviewsNewPage(" + "0" + ");'>";
	    		insertEND = insertEND + "다음";
	    		insertEND = insertEND + "</a></li>";
	    		$("#dyn_ul").append(insertEND);
	    	}
	    	$("#dyn_tbody").empty();
	    	myreviewsNewPage(startIndex);
	    };
	
	    function myreviewsNewPage(pageCurrent) {
	    	if (pageCurrent == -1) {
	    		$("#dyn_tbody").empty();
	    		var newIdx = page - pageMax;
	    		myreviewsPageInsert(newIdx);
	    	}
	    	else if (pageCurrent == 0) {
	    		$("#dyn_tbody").empty();
	    		var newIdx = page + pageMax;
	    		myreviewsPageInsert(newIdx);
	    	}
	    	else {
	    		$("#dyn_tbody").empty();
	    		idx = (pageCurrent * pageList) - pageList;
	    		var checkCount = 1;
	    		for (var i = idx; i < tableList.length; i++) {
	    			if (checkCount > pageList) {
	    				return;
	    			}
	    			var dataParsingComment = JSON.parse(JSON.stringify(tableList[i]));
	    			var writerCCBAASNO = dataParsingComment.writerCCBAASNO;
	    			var writerCCBAMNM1 = dataParsingComment.writerCCBAMNM1;
	    			var writerStarpoint = dataParsingComment.writerStarpoint;
	    			var writerComment = dataParsingComment.writerComment;
	    			var writerCommentDate = dataParsingComment.writerCommentDate;
	    			var insertTr = "";
	    			insertTr += "<tr>";
	    			insertTr += `<td><input type="checkbox" id="myreviewCheckbox${writerCCBAASNO}" class="checkAll" value="${writerCCBAASNO}"></td>`;
	    			insertTr += `<td><label for="myreviewCheckbox${writerCCBAASNO}">${writerCCBAMNM1}</label></td>`;
	    			insertTr += `<td><label for="myreviewCheckbox${writerCCBAASNO}">${writerStarpoint}</label></td>`;
	    			insertTr += `<td><label for="myreviewCheckbox${writerCCBAASNO}">${writerComment}</label></td>`;
	    			insertTr += `<td><label for="myreviewCheckbox${writerCCBAASNO}">${writerCommentDate}</label></td>`;
	    			insertTr += "</tr>";
	    			document.getElementById("dyn_tbody").innerHTML += insertTr;
	    			checkCount++;
	    		}
	    	}
	    };
	    
	    
	    /**
	     * 문화재별 리뷰 게시판
	     */
	    function heritageCommentStart(data){
	    	for (var k = 0; k < data.length; k++) {
				if (data[k].USERID === sessionStorage.getItem("userid")) {
					document.querySelector('#commentInputText').value = '이미 작성하였습니다';
					document.querySelector('#commentInputText').disabled = true;
					document.querySelector('#customRange2').disabled = true;
					document.querySelector('#commentStarpointConfirmButton').disabled = true;
				}
			}
			tableInsert(data);
	    }
	    function tableInsert(data) {
	    	tableList = [];
	    	for (var i = 0; i < data.length; i++) {
	    		var jsonObject = {
	    				"idx": i,
						"writer": data[i].USERID,
						"writerStarpoint": data[i].STARPOINT,
						"writerComment": data[i].COMMENT,
						"writerCommentDate": data[i].COMMENTDATE
	    		};
	    		tableList.push(jsonObject);
	    	}
	    	pageInsert(page);
	    };
	
	    function pageInsert(value) {
	    	$("#dyn_ul").empty();     
	    	var startIndex = value;
	    	var endIndex = tableList.length;
	    	var pageCount = 0;
	    	var pagePlus = 0;
	    	if (endIndex > pageList) { 
	    		pageCount = Math.floor(endIndex / pageList);
	    		pagePlus = endIndex % pageList;
	    		if (pagePlus > 0) {
	    			pageCount = pageCount + 1;
	    		}
	    	}
	    	if (startIndex > pageCount) { 
	    		startIndex = page;
	    	}
	    	else if (startIndex < 0) {
	    		startIndex = page;
	    	}
	    	else {
	    		page = startIndex;
	    	}
	    	if (pageCount == 1) { 
	    		var insertUl = "<li class='page-item'>";
	    		insertUl += insertUl + "<a class='page-link' href='javascript:void(0)' onclick='newPage(1);'>";
	    		insertUl += insertUl + i;
	    		insertUl += insertUl + "</a></li>";
	    		$("#dyn_ul").append(insertUl);
	    	}
	    	else if (pageCount >= 2) { 
	    		var insertSTR = "<li class='page-item'>";
	    		insertSTR = insertSTR + "<a class='page-link' href='javascript:void(0)' onclick='newPage(" + "-1" + ");'>";
	    		insertSTR = insertSTR + "이전";
	    		insertSTR = insertSTR + "</a></li>";
	    		$("#dyn_ul").append(insertSTR);
	    		var count = 1;
	    		for (var i = startIndex; i <= pageCount; i++) {
	    			if (count > pageMax) {
	    				page = i - pageMax;
	    				break;
	    			}
	    			var insertUl = "<li class='page-item'>";
	    			insertUl = insertUl + "<a class='page-link' href='javascript:void(0)' onclick='newPage(" + i + ");'>";
	    			insertUl = insertUl + String(i);
	    			insertUl = insertUl + "</a></li>";
	    			$("#dyn_ul").append(insertUl);
	    			count++;
	    		}
	    		var insertEND = "<li class='page-item'>";
	    		insertEND = insertEND + "<a class='page-link' href='javascript:void(0)' onclick='newPage(" + "0" + ");'>";
	    		insertEND = insertEND + "다음";
	    		insertEND = insertEND + "</a></li>";
	    		$("#dyn_ul").append(insertEND);
	    	}
	    	$("#dyn_tbody").empty();
	    	newPage(startIndex);
	    };
	
	    function newPage(pageCurrent) {
	    	if (pageCurrent == -1) {
	    		$("#dyn_tbody").empty();
	    		var newIdx = page - pageMax;
	    		pageInsert(newIdx);
	    	}
	    	else if (pageCurrent == 0) {
	    		$("#dyn_tbody").empty();
	    		var newIdx = page + pageMax;
	    		pageInsert(newIdx);
	    	}
	    	else { 
	    		$("#dyn_tbody").empty();
	    		idx = (pageCurrent * pageList) - pageList;
	    		var checkCount = 1;
	    		for (var i = idx; i < tableList.length; i++) {
	    			if (checkCount > pageList) {
	    				return;
	    			}
	    			var dataParsingComment = JSON.parse(JSON.stringify(tableList[i]));
	    			var writer = dataParsingComment.writer;
					var writerStarpoint = dataParsingComment.writerStarpoint;
					var writerComment = dataParsingComment.writerComment;
					var writerCommentDate = dataParsingComment.writerCommentDate;
	    			var insertTr = ""; 
	    			insertTr += "<tr>"; 
					insertTr += "<td>" + writer + "</td>";
					insertTr += "<td>" + writerStarpoint + "</td>";
					insertTr += "<td>" + writerComment + "</td>";
					insertTr += "<td>" + writerCommentDate + "</td>";
					insertTr += "</tr>";
	    			document.getElementById("dyn_tbody").innerHTML += insertTr;
	    			checkCount++;
	    		}
	    	}
	    };
	    </script>
		<script th:inline="javascript">
		/**
		 * 세션 초기화
		 */
		function sessionStorageClear() {
			sessionStorage.clear();
		}
		</script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
	</body>
</html>